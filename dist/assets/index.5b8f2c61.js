import{f as e}from"./vendor.123d2af6.js";import"https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.1/firebase-analytics.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const o=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,c)=>{const s=new URL(e,o);if(self[t].moduleMap[s])return a(self[t].moduleMap[s]);const d=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),i=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){c(new Error(`Failed to import: ${e}`)),n(i)},onload(){a(self[t].moduleMap[s]),n(i)}});document.head.appendChild(i)})),self[t].moduleMap={}}}("/assets/");const t={apiKey:"AIzaSyC8GySj4-SJOSVrjc05H5mhEovD6pBUY9E",authDomain:"webrtc-3922f.firebaseapp.com",databaseURL:"https://webrtc-3922f-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"webrtc-3922f",storageBucket:"webrtc-3922f.appspot.com",messagingSenderId:"1022466588162",appId:"1:1022466588162:web:82f02414c816ffb104711b",measurementId:"G-L6XHKC5T25"};e.apps.length||e.initializeApp(t);const a=e.firestore(),o=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});let n=null,c=null;const s=document.getElementById("webcamButton"),d=document.getElementById("webcamVideo"),i=document.getElementById("callButton"),r=document.getElementById("callInput"),l=document.getElementById("answerButton"),p=document.getElementById("remoteVideo"),m=document.getElementById("hangupButton");s.onclick=async()=>{n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),c=new MediaStream,n.getTracks().forEach((e=>{o.addTrack(e,n)})),o.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{c.addTrack(e)}))},d.srcObject=n,p.srcObject=c,i.disabled=!1,l.disabled=!1,s.disabled=!0},i.onclick=async()=>{const e=a.collection("calls").doc(),t=e.collection("offerCandidates"),n=e.collection("answerCandidates");r.value=e.id,o.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const c=await o.createOffer();await o.setLocalDescription(c);const s={sdp:c.sdp,type:c.type};await e.set({offer:s}),e.onSnapshot((e=>{const t=e.data();if(!o.currentRemoteDescription&&(null==t?void 0:t.answer)){const e=new RTCSessionDescription(t.answer);o.setRemoteDescription(e)}})),n.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());o.addIceCandidate(t)}}))})),m.disabled=!1},l.onclick=async()=>{const e=r.value,t=a.collection("calls").doc(e),n=t.collection("answerCandidates"),c=t.collection("offerCandidates");o.onicecandidate=e=>{e.candidate&&n.add(e.candidate.toJSON())};const s=(await t.get()).data().offer;await o.setRemoteDescription(new RTCSessionDescription(s));const d=await o.createAnswer();await o.setLocalDescription(d);const i={type:d.type,sdp:d.sdp};await t.update({answer:i}),c.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(e),"added"===e.type){let t=e.doc.data();o.addIceCandidate(new RTCIceCandidate(t))}}))}))};
